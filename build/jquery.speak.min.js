/*!
 * @copyright Copyright 2016 Wendelin Thomas. All rights reserved
 * Licensed under the MIT License.
 * @see https://github.com/wendelin/jquery.speak/blob/master/LICENSE
 * @author Wendelin Thomas <wendelin.thomas@gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define("jquery.speak",["jquery"],e):e(jQuery)}(function(e){"use strict";var n=window.speechSynthesis,t=(window.SpeechSynthesisVoice||null,n.getVoices&&n.getVoices?n.getVoices():[]);if(!n||!t.length)throw new Error("'speechSynthesis' not supported by browser");var o=e.speak=function(i,a,r){if(a=a||{},e.isPlainObject(a)||(a={lang:a}),a=e.extend({},e.speak.DEFAULTS,a),2===arguments.length&&(r=!0),a.lang&&(a.voice.lang=a.lang,delete a.lang),t.length&&a.voice){var c=o.getVoice(a.voice);!c&&a.voice.name&&a.voice.lang&&(c=o.getVoice(a.voice.lang)),a.voice=c||null}var s=new SpeechSynthesisUtterance(i),l=e(s);return a.on&&(l.on(a.on),delete a.on),e.extend(s,a),r&&o.cancel(),n.speak(s),l};return o.getVoices=function(n){var o,i;e.isPlainObject(n)?(o=n.name,i=n.lang):i=n;var a=e.grep(t,function(e){return!(o&&e.name.indexOf(o)===-1||i&&e.lang.indexOf(i)===-1)});return a},o.getVoice=function(e){return this.getVoices(e)[0]||null},o.parseSSML=function(n){for(var t,o=n,i=o,a=0,r=["en"],c=[{lang:"en"}],s=[];i;){if(i.childNodes&&i.childNodes.length>0)a++,c[a]=e.extend({},c[a-1]),i.nodeType===o.ELEMENT_NODE&&i.hasAttribute("xml:lang")&&(c[a].lang=i.getAttribute("xml:lang")),"voice"===i.nodeName.toLowerCase()&&(c[a].voice=e.extend({},c[a].voice||{}),e.each(["gender","age","variant","name"],function(e,n){c[a].voice[n]=i.getAttribute(n)})),"prosody"===i.nodeName.toLowerCase()&&(c[a].prosody=e.extend({},c[a].prosody||{}),e.each(["pitch","contor","rate","range","duration","volumne"],function(e,n){c[a].prosody[n]=i.getAttribute(n),c[a][n]=i.getAttribute(n)})),r[a]=t=i.nodeType===o.ELEMENT_NODE&&i.hasAttribute("xml:lang")?i.getAttribute("xml:lang"):r[a-1],i=i.firstChild;else if(i.nextSibling)i=i.nextSibling;else{do if(i=i.parentNode,a--,i===o)return s;while(!i.nextSibling);i=i.nextSibling}i.nodeType===o.TEXT_NODE&&i.textContent.trim()&&s.push({node:i,params:c[a]})}return s},o.ssml=function(n){var t=this.parseSSML(n);e.each(t,function(n,t){var i=t.node.textContent,a=t.params,r=t.node;console.log({text:i,params:a,node:r,speak:o(i,e.extend(a||{},{on:{start:function(){console.log(this.voice&&this.voice.lang,this.voice&&this.voice.name,this.text)},boundary:function(e){if(e.charIndex){var n=(e.target,e.target.text.substr(e.charIndex).match(/^.\w*/)[0]||"");console.log(n,e.charIndex,e.target.text.substr(e.charIndex))}}}}),!1)})})},e.each(["pause","paused","resume","cancel","speaking"],function(t,i){o[i]=e.isFunction(n[i])?function(){return n[i]()}:function(){return n[i]}}),o.DEFAULTS={pitch:1,rate:1,voice:{name:null,lang:e("html").attr("lang")||"en"},volume:1,on:{}},e});